#!/bin/sh
#
# Creates just a toolchain, for use with EasyBuild

# http://stackoverflow.com/questions/2870992/automatic-exit-from-bash-shell-script-on-error
set -e
# Any subsequent(*) commands that fail will cause the shell script to exit immediately

# http://stackoverflow.com/questions/2853803/in-a-shell-script-echo-shell-commands-as-they-are-executed
set -o verbose

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

export MACPORTS=$HOME/macports/mpgompi-4.9.3
PORT=$MACPORTS/bin/port
PIP=$MACPORTS/bin/pip

# ==================================================================

# Install stuff to it
# -------- Core System: Compilers, etc.
$PORT install gcc49 +gfortran
$PORT select --list gcc
$PORT select gcc mp-gcc49

$PORT install openmpi-gcc49
$PORT select --set mpi openmpi-gcc49-fortran

#cd $MACPORTS/bin
#rm -f mpifort
#ln -s `readlink mpifort-openmpi-gcc49` mpifort

$PORT install cmake   # EasyBuild CMake chokes on MacPorts

# Boost requires SOME python.  If you don't give it python34, it will install
# its own python27.
$PORT install -f python34 +readline configure.compiler=macports-gcc-4.9 # configure.objc=clang
$PORT install boost +python34 configure.compiler=macports-gcc-4.9
$PORT install xz

# Python
$PORT select --set python python34
$PORT install py34-cython configure.compiler=macports-gcc-4.9
$PORT select --set cython cython34

$PORT install fftw-3 +gcc49 +openmpi configure.compiler=macports-gcc-4.9  # Needed for Numpy
$PORT install py34-numpy +gcc49
$PORT -f install py34-scipy +gcc49

$PORT -f install py34-virtualenv
$PORT -f install py34-pip
$PORT select --set pip pip34
$PORT select --set virtualenv virtualenv34

$PORT -f install py34-gobject3
$PORT -f install py34-tz
$PORT -f install py34-cffi

# Put this in a virtualenv in $MACPORTS/pyenv
# Do NOT mix pip and port installs
# $PIP install cairocffi

$PORT -f install py34-matplotlib +cairo +pdftops +ghostscript +webagg # +latex
$PORT -f install geos configure.compiler=macports-gcc-4.9
$PORT -f install py34-matplotlib-basemap py34-pyproj
$PORT install py34-netcdf4

# Get Matplotlib with libjpeg to work...
# https://lists.macosforge.org/pipermail/macports-users/2010-November/022662.html
